基于您提供的 `go-stock` 项目参考及之前的讨论，我对产品设计文档进行了优化和细化。新方案旨在借鉴现有开源项目的优点，并融入更专业的金融工程理念与实用的技术架构。

以下是优化后的产品设计文档。

# 智股通（SmartStock Insider） - 智能量化投研平台 - 优化版产品设计文档

## 1. 项目概述与定位优化

本产品（智股通）是一个**面向个人量化投资者与进阶散户的智能投研平台**。核心目标是将传统技术口诀、现代量化分析、人工智能辅助决策深度融合，提供一个**信号驱动、风险可控、决策高效**的一体化投资分析工具。

*   **核心价值提升**：
    *   **策略化**：将新旧口诀从经验规则转化为可回溯、可优化的量化策略。
    *   **系统化**：构建从数据采集、信号计算、AI分析到风险预警的完整闭环。
    *   **个性化**：允许用户对信号参数、组合权重进行自定义，适配不同风险偏好。

## 2. 跨平台桌面应用架构设计

为满足多平台使用需求，智股通采用跨平台桌面应用架构，支持Windows、macOS、Linux三大操作系统。

### 2.1 整体架构设计

```
┌─────────────────────────────────────────────────────────────────┐
│                    跨平台桌面应用层 (Wails)                      │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐ │
│  │   UI层          │    │   系统集成层    │    │   平台适配层    │ │
│  │                 │    │                 │    │                 │ │
│  │ ● React + TS    │◄──►│ ● Go Backend    │◄──►│ ● Windows/macOS │ │
│  │ ● Ant Design    │    │ ● 系统托盘      │    │ ● Linux         │ │
│  │ ● ECharts       │    │ ● 系统通知      │    │ ● 自启动管理    │ │
│  │ ● 路由管理      │    │ ● 单实例控制    │    │ │               │ │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        核心服务层                                │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐ │
│  │   API服务       │    │   数据服务      │    │   AI服务         │ │
│  │                 │    │                 │    │                 │ │
│  │ ● Go Gin        │◄──►│ ● Go采集引擎    │◄──►│ ● Python FastAPI│ │
│  │ ● REST API      │    │ ● 数据更新      │    │ ● AI模型推理    │ │
│  │ ● WebSocket     │    │ ● 增量同步      │    │ ● 多角色助手    │ │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        数据存储层                                │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐ │
│  │   主数据库      │    │   缓存层        │    │   外部数据源    │ │
│  │                 │    │                 │    │                 │ │
│  │ ● SQLite (纯Go) │◄──►│ ● Redis         │◄──►│ ● akshare       │ │
│  │ ● 零配置数据库   │    │ │               │    │ │               │ │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

**跨平台技术栈**：
*   **Wails v2**: Go + React 跨平台桌面应用框架，替代传统Web应用架构
*   **Go 1.24+**: 高性能后端服务，处理数据采集、API接口、系统集成
*   **React 18 + TypeScript**: 现代化前端界面，提供优秀的用户体验
*   **Python 3.9+**: AI分析服务，支持复杂的量化计算和机器学习
*   **SQLite (modernc.org/sqlite 纯Go驱动) + Redis**: 本地数据存储和缓存，确保离线可用性

**核心优势**：
*   **跨平台兼容**: 一套代码支持Windows、macOS、Linux，100%可靠部署
*   **桌面集成**: 完整的系统托盘、通知、自启动功能
*   **离线优先**: 本地数据存储，减少对网络的依赖
*   **高性能**: Go语言提供出色的数据处理和并发能力
*   **零配置安装**: 纯Go技术栈，用户无需任何环境配置
*   **单一可执行文件**: 包含所有依赖，简化分发和安装

### 2.2 跨平台桌面功能设计

#### **1. 系统托盘集成**
*   **跨平台支持**: Windows任务栏托盘、macOS菜单栏、Linux系统托盘
*   **功能菜单**: 显示/隐藏主窗口、数据更新、设置、关于、退出
*   **状态指示**: 数据更新状态、信号提醒、连接状态
*   **图标状态**: 根据信号强度动态变化图标

#### **2. 自启动管理**
*   **Windows**: 注册表项管理 (`HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`)
*   **macOS**: Launch Agent (`~/Library/LaunchAgents/com.smartstock.insider.plist`)
*   **Linux**: Desktop Entry (`~/.config/autostart/smart-stock-insider.desktop`)
*   **用户控制**: 应用内开关，权限申请

#### **3. 系统通知**
*   **Windows**: Windows 10/11 原生通知API
*   **macOS**: User Notifications Framework
*   **Linux**: libnotify 库支持
*   **通知类型**: 个股异动、买卖信号、风险预警、系统状态

#### **4. 单实例控制**
*   **互斥锁**: 跨平台的进程互斥机制
*   **窗口激活**: 激活已运行的实例而非启动新实例
*   **参数传递**: 命令行参数传递给运行中的实例

#### **5. 平台特定功能**
*   **Windows**: Windows服务注册、系统集成
*   **macOS**: Dock集成、Touch Bar支持、沙盒兼容
*   **Linux**: 桌面环境适配、包管理器支持

### 2.3 核心业务模块

#### **1. 数据采集与处理引擎 (Go)**
*   **统一数据接口**：抽象化数据源，兼容akshare、Tushare等，支持故障自动切换。
*   **增量更新机制**：基于时间戳的行情数据增量更新，提升效率。
*   **财务数据非结构化处理**：借鉴 `x-stock` 项目，解析PDF年报、公司公告，并结构化存储。

#### **2. 技术分析引擎 (Python + Go)**
此为核心，将口诀彻底量化。
```python
# 示例：优化后的“高位放量上涨，离场信号”量化规则
def high_position_high_volume_signal(stock_data, lookback_days=60):
    """
    量化规则：
    1. 位置判断：当前价处于过去lookback_days内的90%分位数以上 -> 高位
    2. 放量判断：当日成交量超过过去20日平均成交量的150%
    3. 上涨判断：当日涨幅 > 3%
    4. 信号确认：K线形态为长上影线或阴线，增强信号准确性
    """
    current_price = stock_data['close'].iloc[-1]
    high_threshold = stock_data['close'].rolling(lookback_days).quantile(0.9).iloc[-1]

    volume_ma = stock_data['volume'].rolling(20).mean().iloc[-1]
    current_volume = stock_data['volume'].iloc[-1]

    price_change = (stock_data['close'].iloc[-1] - stock_data['close'].iloc[-2]) / stock_data['close'].iloc[-2]

    is_high = current_price >= high_threshold
    is_high_volume = current_volume >= volume_ma * 1.5
    is_rising = price_change > 0.03

    # 综合判断
    if is_high and is_high_volume and is_rising:
        return "STRONG_SELL", 0.95  # 信号强度
    else:
        return "NO_SIGNAL", 0.0
```

#### **3. 多角色AI助手增强**
在原有三个分析师基础上，新增 **“风险控制专员”** 角色。
*   **技术面分析师**：融合传统指标与机器学习，识别K线形态、量价异常点。
*   **基本面分析师**：借鉴 `x-stock` 项目的财务健康度模型，评估ROE、毛利率、负债率等，计算内在价值。
*   **消息面分析师**：使用NLP模型分析新闻、研报、社交媒体情感倾向。
*   **风险控制专员**：
    *   监控持仓集中度、整体波动率。
    *   基于历史回测计算最大回撤，提示止损止盈。
    *   提供仓位配置建议（如：波动率低的股票可适当提高仓位权重）。

## 3. 信号系统与策略回测优化

### 3.1 多维信号融合
**旧口诀**可能产生冲突信号，新系统通过加权评分解决：
`综合信号强度 = (技术面权重 * 技术信号) + (基本面权重 * 基本面信号) + (消息面权重 * 消息信号)`
用户可根据自身是技术派、价值派或消息派，动态调整权重。

### 3.2 策略回测引擎
为每一个量化后的口诀提供历史回测功能。
*   **回测指标**：年化收益、夏普比率、最大回撤、胜率。
*   **可视化展示**：策略收益曲线与基准（如沪深300）的对比图。

## 4. 界面设计与用户体验优化

### 4.1 仪表盘主页
采用**个人投资驾驶舱**设计。
```
┌─────────────────┬─────────────────┬─────────────────┐
│   投资组合      │   信号雷达      │   实时预警      │
│  ● 收益曲线     │  ● 自选股信号灯 │  ● 紧急列表     │
│  ● 资产分布     │   矩阵          │  ● 异动监控     │
│  ● 风险指标     │                 │                 │
└─────────────────┴─────────────────┴─────────────────┘
┌─────────────────┬─────────────────┬─────────────────┐
│    AI助手聚合   │   新闻热点      │   策略推荐      │
│  ● 多角色观点   │  ● 宏观要闻     │  ● 经典口诀策略 │
│  ● 综合结论     │  ● 个股快讯     │  ● 智能匹配策略 │
└─────────────────┴─────────────────┴─────────────────┘
```

### 4.2 个股详情页优化
*   **技术分析Tab**：K线图上直接**标记出口诀信号的发生点**（如：绿色箭头表示“高位放量下跌”）。
*   **基本面Tab**：采用雷达图展示财务健康度（如：`x-stock` 的ROE、负债、估值等维度）。
*   **AI分析Tab**：以对话式界面与四个AI助手交互，并可生成**投资分析报告PDF**。

## 5. 数据模型与API设计要点

### 5.1 核心数据表
*   `stock_basic` (股票基本信息)
*   `stock_daily` (日线行情)
*   `technical_signals` (技术信号记录)
*   `ai_analysis_log` (AI分析记录)
*   `user_portfolio` (用户持仓)

### 5.2 API接口设计 (Go Gin框架示例)
```go
// 获取自选股信号灯列表
GET /api/watchlist/signals

// 获取个股AI分析报告（整合多角色）
POST /api/stock/:code/analysis

// WebSocket实时推送个股异动信号
WS /ws/stock/alerts
```

## 6. 跨平台部署与分发

### 6.1 构建与打包
*   **Wails CLI**: 跨平台构建工具，支持多目标架构
*   **自动构建**: GitHub Actions 多平台CI/CD流水线
*   **纯Go技术栈**: 无CGO依赖，简化构建过程
*   **安装包**:
  - Windows: NSIS安装包 (.exe) - 单一可执行文件
  - macOS: DMG磁盘映像 - 包含所有依赖
  - Linux: AppImage、DEB、RPM包 - 零配置运行
*   **代码签名**: 各平台数字证书，确保应用安全性
*   **一键安装**: 用户无需任何环境配置，直接运行安装

### 6.2 更新机制
*   **自动检查**: 启动时检查更新版本
*   **增量更新**: 只下载变更部分，减少带宽消耗
*   **回滚机制**: 更新失败时自动回退到之前版本
*   **用户控制**: 可选择自动更新或手动确认

## 7. 实施路线图与风险控制

### 7.1 分阶段开发
1.  **第一阶段 (跨平台MVP - 6周)**：
    - Wails桌面应用框架搭建
    - Go数据采集服务
    - React前端界面
    - 基础技术信号计算
    - 跨平台构建测试

2.  **第二阶段 (桌面功能完善 - 8周)**：
    - 完整系统托盘功能
    - 跨平台自启动管理
    - 系统通知集成
    - AI助手（技术面、消息面）
    - 完整信号体系

3.  **第三阶段 (高级功能 - 6周)**：
    - 基本面分析
    - 风险控制专员
    - 策略回测引擎
    - 平台特定功能优化
    - 性能优化和稳定性提升

### 7.2 跨平台风险控制
*   **平台兼容性**：纯Go技术栈确保100%跨平台兼容性，持续测试各平台版本
*   **权限管理**：处理不同平台的权限申请机制
*   **数据风险**：多家数据源备份，确保稳定性；本地数据加密存储
*   **策略风险**：在系统显著位置提示"所有信号仅供参考，不构成投资建议"
*   **技术风险**：纯Go技术栈降低环境配置风险；对信号计算、AI分析结果建立人工反馈纠错机制，持续优化模型
*   **部署风险**：零配置安装确保用户成功安装率，降低技术支持成本

## 8. 项目文件结构

```
smart-stock-insider/
├── backend/                     # Wails 后端代码
│   ├── main.go                 # 应用入口
│   ├── internal/               # 内部模块
│   │   ├── desktop/            # 桌面应用管理
│   │   ├── platform/           # 平台适配层
│   │   │   ├── windows/        # Windows特定功能
│   │   │   ├── darwin/         # macOS特定功能
│   │   │   └── linux/          # Linux特定功能
│   │   ├── services/           # 核心服务
│   │   └── models/             # 数据模型
│   └── embed/                  # 嵌入资源
├── frontend/                    # React 前端代码
│   ├── src/                    # 源码
│   │   ├── components/         # 组件
│   │   ├── pages/              # 页面
│   │   ├── services/           # API服务
│   │   └── styles/             # 样式
│   ├── dist/                   # 构建输出
│   └── public/                 # 静态资源
├── scripts/                     # 构建脚本
│   ├── build/                  # 构建脚本
│   │   ├── build-all.sh        # 跨平台构建
│   │   └── build-windows.bat   # Windows构建
│   └── deploy/                 # 部署脚本
│       └── create-installer.nsi # NSIS安装包
├── wails.json                   # Wails 配置
├── go.mod                      # Go 模块
└── 产品设计文档.md              # 本文档
```
