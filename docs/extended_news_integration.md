# 扩展新闻源集成文档

## 概述

智股通扩展新闻源模块新增了多个主流财经媒体平台的支持，实现了智能新闻聚合、去重和聚类功能。

## 新增新闻源

### 1. 新浪财经
- **ID**: `sina`
- **描述**: 新浪财经新闻API，提供实时财经资讯
- **特点**:
  - 高更新频率（120次/分钟）
  - 覆盖A股、港股、美股
  - 包含快讯、深度报道
- **API端点**: `https://finance.sina.com.cn/7x24/`

### 2. 腾讯财经
- **ID**: `tencent`
- **描述**: 腾讯财经新闻API，提供专业的财经新闻报道
- **特点**:
  - 专业财经内容
  - 数据质量稳定
  - 支持多种分类
- **API端点**: `https://finance.qq.com/api/a/search`

### 3. 雪球
- **ID**: `xueqiu`
- **描述**: 雪球社区动态，提供投资者讨论和观点
- **特点**:
  - 社区驱动的投资观点
  - 实时用户讨论
  - 情感分析数据丰富
- **API端点**: `https://xueqiu.com/statuses/hot_timeline_v2.json`

### 4. 和讯网
- **ID**: `hexun`
- **描述**: 和讯网专业财经新闻，提供深度分析报道
- **特点**:
  - 专业财经分析
  - 行业研究报告
  - 专家观点集合
- **API端点**: `https://news.hexun.com/api/news/list`

### 5. 财新网（需要授权）
- **ID**: `caixin`
- **描述**: 财新网深度财经报道
- **特点**:
  - 深度调查报道
  - 高质量内容
  - 需要API密钥

### 6. 华尔街见闻（需要授权）
- **ID**: `wallstreetcn`
- **描述**: 华尔街见闻实时资讯
- **特点**:
  - 全球市场资讯
  - 专业投资分析
  - 需要API密钥

## 核心功能

### 1. 智能新闻聚合

#### 去重算法
- **标题去重**: 基于标题相似度（默认阈值0.85）
- **内容去重**: 基于内容哈希比对
- **保留策略**: 保留优先级最高的源的内容

#### 相似内容聚类
- **时间窗口**: 2小时内新闻进行聚类
- **相似度阈值**: 0.7
- **聚类大小**: 2-10条新闻
- **代表新闻选择**: 选择影响力和相关性最高的新闻

#### 热门话题识别
- **最小文章数**: 3条相关新闻
- **时间窗口**: 2小时
- **关键词匹配**: 自动识别热门话题
- **影响评分**: 基于新闻数量、相关性和时间新鲜度

### 2. 新闻源管理

#### 状态监控
- **健康检查**: 实时监控新闻源可用性
- **性能指标**: 响应时间、成功率、错误率
- **自动重试**: 失败自动重试机制
- **速率限制**: 防止超出API限制

#### 配置管理
- **动态启用/禁用**: 可动态配置新闻源状态
- **优先级调整**: 支持新闻源优先级设置
- **自定义参数**: 支持自定义请求头和参数

### 3. 数据质量评分

#### 可靠性评分
- 基于历史表现
- 错误率统计
- 数据时效性评估
- 用户反馈整合

#### 内容新鲜度
- 24小时内新闻加分
- 时间衰减计算
- 突发事件加权

#### 相关性评分
- 标题匹配权重: 50%
- 内容匹配权重: 30%
- 标签匹配权重: 20%

## API接口

### 获取扩展新闻分析
```go
result := app.GetExtendedNewsAnalysis("000001", 7, []string{"sina", "tencent", "xueqiu"})
```

**参数**:
- `stockCode`: 股票代码（可选）
- `days`: 查询天数
- `sources`: 指定的新闻源列表（可选）

**返回**:
```json
{
  "success": true,
  "data": {
    "stock_code": "000001",
    "total_news": 25,
    "positive_news": 8,
    "negative_news": 3,
    "neutral_news": 14,
    "news_by_source": {
      "新浪财经": 8,
      "腾讯财经": 6,
      "雪球": 5,
      "东方财富": 6
    },
    "top_headlines": [...],
    "key_topics": [...],
    "sentiment_score": 0.12
  }
}
```

### 获取新闻源状态
```go
status := app.GetNewsSourceStatus()
```

### 获取新闻源指标
```go
metrics := app.GetNewsSourceMetrics()
```

### 获取新闻聚类信息
```go
clusters := app.GetNewsClusters()
```

### 获取重复新闻信息
```go
duplicates := app.GetNewsDuplicates()
```

## 配置文件

### 扩展新闻源配置
位置: `config/extended_news_sources.json`

```json
{
  "version": "1.0",
  "auto_refresh": true,
  "refresh_interval": 300,
  "sources": {
    "sina": {
      "enabled": true,
      "rate_limit": 120,
      "priority": 1
    }
  },
  "aggregation_rules": {
    "duplicate_detection": {
      "enabled": true,
      "similarity_threshold": 0.85
    }
  }
}
```

## 性能优化

### 1. 并发处理
- 多新闻源并发获取
- 信号量控制并发数
- 超时控制机制

### 2. 缓存策略
- 新闻内容缓存15分钟
- 聚合结果缓存30分钟
- 源状态缓存1分钟

### 3. 速率限制
- 按源独立限制
- 动态调整请求间隔
- 错误退避机制

## 使用建议

### 1. 新闻源选择
- **全面覆盖**: 启用所有主要新闻源
- **质量优先**: 优先启用专业财经媒体
- **社区观点**: 包含雪球等社区讨论

### 2. 聚合策略
- **高精度**: 设置较高的去重阈值（0.9+）
- **高召回**: 设置较低的聚类阈值（0.6+）
- **实时监控**: 关注热门话题识别

### 3. 性能调优
- **并发数**: 根据服务器性能调整并发数
- **缓存时间**: 根据新闻更新频率调整缓存时间
- **速率限制**: 遵守各新闻源的API限制

## 错误处理

### 常见错误
1. **API限制**: 自动调整请求频率
2. **网络错误**: 自动重试机制
3. **数据格式错误**: 降级处理
4. **服务不可用**: 切换备用源

### 监控指标
- 成功率 > 95%
- 平均响应时间 < 2秒
- 错误率 < 5%
- 数据完整性 > 98%

## 扩展开发

### 添加新新闻源
1. 在 `extended_news_sources.go` 中定义新源
2. 实现对应的 fetch 方法
3. 添加解析逻辑
4. 更新配置文件
5. 添加单元测试

### 自定义聚合规则
1. 在 `news_aggregator.go` 中添加新规则
2. 实现匹配逻辑
3. 定义处理动作
4. 测试规则效果

## 注意事项

1. **合规性**: 遵守各新闻源的使用条款
2. **数据版权**: 尊重数据版权和引用
3. **用户隐私**: 不存储用户个人信息
4. **服务稳定性**: 实现故障转移和降级机制

---

*最后更新: 2024年1月*