# 智股通数据服务

智股通数据服务是一个基于FastAPI和akshare的Python微服务，为智股通应用提供实时的股票数据获取和处理功能。

## 功能特性

### 🔄 数据获取
- **股票基本信息**: 获取股票代码、名称、行业、市场等基本信息
- **实时行情**: 获取股票实时价格、涨跌幅、成交量等数据
- **历史数据**: 获取股票日线历史数据，支持自定义时间范围
- **市场指数**: 获取上证指数、深证成指、创业板指等主要指数
- **行业板块**: 获取行业分类和板块信息

### 🚀 性能优化
- **智能缓存**: 基于TTL的缓存机制，减少API调用次数
- **异步处理**: 使用异步IO提升并发性能
- **批量请求**: 支持批量获取多只股票数据
- **错误重试**: 自动重试机制，提高数据获取成功率

### 📊 API接口
- **RESTful API**: 标准REST接口，易于集成
- **自动文档**: 基于OpenAPI的自动文档生成
- **统一响应格式**: 标准化的API响应格式
- **健康检查**: 服务健康状态监控

## 快速开始

### 环境要求
- Python 3.8+
- 网络连接（用于访问akshare数据源）

### 安装依赖

```bash
# 安装Python依赖包
pip install -r requirements.txt
```

### 启动服务

#### 方式一：使用启动脚本（推荐）
```bash
python start.py
```

#### 方式二：直接启动
```bash
python main.py
```

服务启动后：
- 服务地址: http://127.0.0.1:8001
- API文档: http://127.0.0.1:8001/docs
- 健康检查: http://127.0.0.1:8001/health

## API接口文档

### 基础接口

#### 健康检查
```http
GET /health
```

#### 获取系统信息
```http
GET /
```

### 股票数据接口

#### 获取股票基本信息
```http
GET /api/stock/basic?code=000001
```

#### 获取股票列表
```http
GET /api/stock/basic?limit=100&offset=0
```

#### 获取日线数据
```http
GET /api/stock/daily?code=000001&start_date=20240101&end_date=20241231&limit=200
```

#### 获取实时数据
```http
GET /api/stock/realtime?code=000001
```

#### 批量获取数据
```http
GET /api/stock/batch?codes=000001,600000&fields=basic,daily,realtime
```

### 市场数据接口

#### 获取市场指数
```http
GET /api/market/index
```

#### 获取行业数据
```http
GET /api/market/sectors
```

### 数据管理接口

#### 刷新缓存
```http
POST /api/data/refresh
```

#### 获取服务状态
```http
GET /api/data/status
```

## 响应格式

所有API接口都使用统一的响应格式：

```json
{
  "success": true,
  "message": "操作成功",
  "data": {
    // 具体数据内容
  },
  "error": null,
  "timestamp": "2024-01-01T12:00:00"
}
```

## 配置说明

### 环境变量

| 变量名 | 默认值 | 说明 |
|--------|--------|------|
| DEBUG | false | 调试模式 |
| SERVER_HOST | 127.0.0.1 | 服务监听地址 |
| SERVER_PORT | 8001 | 服务监听端口 |
| DATABASE_URL | sqlite:///./data/cache.db | 数据库连接字符串 |

### 缓存配置

- **缓存过期时间**: 5分钟
- **最大缓存项**: 1000个
- **缓存类型**: 内存缓存（TTLCache）

### 技术指标参数

```python
TECHNICAL_INDICATORS = {
    "MA": [5, 10, 20, 60],           # 移动平均线
    "EMA": [12, 26],                  # 指数移动平均线
    "MACD": {"fast": 12, "slow": 26, "signal": 9},  # MACD指标
    "RSI": {"period": 14},            # RSI相对强弱指标
    "KDJ": {"n": 9, "m1": 3, "m2": 3}, # KDJ随机指标
    "BOLL": {"n": 20, "k": 2},        # 布林带
    "CCI": {"period": 14},            # CCI顺势指标
    "WR": {"period": 14}              # 威廉指标
}
```

## 数据源说明

本服务使用[akshare](https://github.com/akfamily/akshare)作为数据源，akshare是一个开源的Python财经数据接口库。

### 支持的数据类型
- A股股票数据（上海证券交易所、深圳证券交易所、北京证券交易所）
- 股票基本信息、实时行情、历史数据
- 市场指数、行业板块
- 财务数据、宏观数据等

### 数据更新频率
- **实时数据**: 交易时间内实时更新
- **历史数据**: 每日收盘后更新
- **基本信息**: 定期更新

## 性能优化建议

### 缓存策略
- 启用缓存可以显著提升响应速度
- 根据使用情况调整缓存过期时间
- 定期清理过期缓存避免内存占用过高

### 并发控制
- 使用异步请求提高并发性能
- 控制请求频率避免触发限制
- 实现请求队列和错误重试机制

### 数据同步
- 建议在非交易时间进行大量数据同步
- 使用批量接口减少请求次数
- 实现增量同步减少数据传输量

## 故障排除

### 常见问题

#### 1. 服务启动失败
- 检查Python版本是否满足要求
- 确认所有依赖包已正确安装
- 检查端口是否被占用

#### 2. 数据获取失败
- 检查网络连接
- 确认股票代码格式正确
- 查看akshare服务状态

#### 3. 性能问题
- 启用缓存机制
- 调整请求频率限制
- 检查内存使用情况

### 日志查看

服务运行时会产生详细的日志信息：
- 控制台输出：实时日志信息
- 日志文件：data-service.log（如果启用）

## 开发指南

### 项目结构
```
data-service/
├── main.py              # 主程序入口
├── data_provider.py     # 数据提供者模块
├── config.py           # 配置文件
├── requirements.txt    # 依赖包列表
├── start.py            # 启动脚本
└── README.md           # 项目说明
```

### 扩展开发

#### 添加新的数据接口
1. 在`data_provider.py`中添加新的数据获取方法
2. 在`main.py`中添加对应的API路由
3. 更新API文档和类型定义

#### 集成其他数据源
1. 创建新的数据提供者类
2. 实现统一的数据接口
3. 在配置中添加数据源选择选项

## 许可证

本项目采用MIT许可证，详情请查看LICENSE文件。

## 贡献指南

欢迎提交Issue和Pull Request来改进本项目。

## 联系方式

如有问题或建议，请通过以下方式联系：
- GitHub Issues
- 邮箱：[your-email@example.com]

---

**注意**: 本服务仅用于学习和研究目的，所有数据仅供参考，不构成投资建议。